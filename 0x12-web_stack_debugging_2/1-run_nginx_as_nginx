#!/usr/bin/env bash

# Create nginx user if it doesn't exist
if ! id "nginx" >&/dev/null; then
    useradd -r nginx
fi

# Update the Nginx configuration
sed -i 's/^user .*/user nginx;/' /etc/nginx/nginx.conf
sed -i 's/listen \\+\\(::\\)\\?/listen 0.0.0.0:8080;/' /etc/nginx/sites-available/default

# Ensure the correct permissions
chown -R nginx:nginx /var/lib/nginx
chmod -R 755 /var/lib/nginx

# Check and configure firewall rules
if command -v ufw >/dev/null 2>&1; then
    ufw allow 8080/tcp
    ufw reload
fi

# Restart Nginx
sudo systemctl restart nginx
